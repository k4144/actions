name: project-ci

on:
  workflow_call:
    inputs:
      python-version:
        description: Python version to use for all jobs.
        type: string
        default: "3.11"
      run-bandit:
        description: Set to false to skip Bandit security scanning.
        type: boolean
        default: true
      package-name:
        description: Python package name used for version discovery.
        type: string
        default: ""
      publish-on:
        description: Git ref (branch or tag prefix) required for automated publishing. Leave
          empty to allow publishing from any push that contains a version bump.
        type: string
        default: ""
      badge-commit-message:
        description: Commit message to use when badge assets change.
        type: string
        default: "chore: update workflow badges"
    outputs:
      should_publish:
        description: Whether all release checks passed and publishing is allowed.
        value: ${{ jobs.pipeline.outputs.should_publish }}
      dist_artifact:
        description: Name of the uploaded distribution artifact when a publish is triggered.
        value: ${{ jobs.pipeline.outputs.dist_artifact }}
    secrets:
      pypi-token:
        description: PyPI token for checking version existence (optional).
        required: false

permissions:
  contents: write
  id-token: write

jobs:
  pipeline:
    uses: ./.github/workflows/ci-python.yml
    with:
      python-version: ${{ inputs.python-version }}
      run-bandit: ${{ inputs.run-bandit }}
      package-name: ${{ inputs.package-name }}
      badge-commit-message: ${{ inputs.badge-commit-message }}
    secrets:
      pypi-token: ${{ secrets.pypi-token }}